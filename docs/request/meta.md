# Meta communication

System information from 2300 is divided over both request/reply and publish/subscribe. The messages below are published
by 2300.

## Get static

Get system information from 2300. This information is retrieved only once, normally at startup time for 2200.

!!! info
    The schemas for validation inherit from the **base schema** and can be found in:

    * `/schemas/get_static/request.schema.json`
    * `/schemas/get_static/reply_success.schema.json`
    * `/schemas/get_static/reply_failure.schema.json`

### Get static request payload

This message does not require any additional information in the payload section.

### Get static request example

```json title="get_static_request.json" linenums="1"
{
    "command": "get_static",
    "version": "0.2.0"
}
```

### Get static reply payload

| Key | Type | Value |
| --- | --- | --- |
| `nqubits` | `int` | The number of qubits |
| `topology` | `list[tuple]` | List of the edges between the various qubits |
| `name` | `str` | Name of the system |
| `pgs` | `list[str]` | Supported primitive gates set of the system. Gate names as described in cQASM (in uppercase) |
| `starttime` | `float` | Timestamp of start-up of the system (return value of `time.time()`) |
| `default_compiler_config` | `dict[str,list[dict[str, Any]]]` | Compiler configurations for different stages. |

### Get static reply example

```json title="get_static_reply.json" linenums="1"
{
    "status": "success",
    "payload": {
        "nqubits": 5,
        "topology": [
            [0, 2],
            [1, 2],
            [3, 2],
            [4, 2]
        ],
        "name": "Starmon-5",
        "pgs": [
            "X",
            "Y"
        ],
        "starttime": 1690061619.610174,
        "default_compiler_config": {
            "decomposition": [
                {
                    "path": "opensquirrel.decomposer.mckay_decomposer.McKayDecomposer",
                    "method": "decompose",
                    "arguments": {}
                }
            ]
        }
    },
    "version": "0.2.0"
}
```

##### Compiler configuration

The compiler configuration defines the pre-processing needed to convert the user-provided circuit into one that the
backend can process. This comprises a list of steps that should be applied to the circuit using the Opensquirrel
library. The config is represented as a dict and defines for each _stage_, a list of _passes_ (ie preprocessing actions)
that should be performed in the stage. Each pass includes settings such as the pass _name_, corresponding _method_
invoked by opensquirrel and additional keyword arguments.

Currently, the following stages are supported:

* `decomposition`:
  * `path`: `opensquirrel.<path_to_decomposer_class>`.
See the _decomposers_ listed in [the opensquirrel docs](https://qutech-delft.github.io/OpenSquirrel/reference).
  * `method`: `decompose`
  * `arguments`: arguments expected for the initialization of the decomposer class.

If no `default_compiler_config` is provided, there will be **no** pre-processing steps applied to the circuit.
The backend will receive the cQASM string the same way it was provided by the user.

## Get dynamic

Dynamic information is generated by 2300. This information can for example constitute calibration data like T1 and T2*.
This dynamic metadata fetched on a status change from `CALIBRATING`/`OFFLINE` to `IDLE` or on startup of 2200.

!!! info
    The schemas for validation inherit from the **base schema** and can be found in:

    * `/schemas/get_dynamic/request.schema.json`
    * `/schemas/get_dynamic/reply_success.schema.json`
    * `/schemas/get_dynamic/reply_failure.schema.json`

### Get dynamic request payload

This message does not require any additional information in the payload section.

### Get dynamic request example

```json title="get_dynamic_request.json" linenums="1"
{
    "command": "get_dynamic",
    "version": "0.2.0"
}
```

### Get dynamic reply payload

The payload for the message is still under advisement. The appropriate key-value pairs will be filled in when they are
determined.

| Key | Type | Value |
| --- | --- | --- |
| - | - | - |

### Get dynamic reply example

```json title="get_dynamic_reply.json" linenums="1"
{
    "status": "success",
    "payload": {
        // to be determined
    },
    "version": "0.2.0"
}
```
